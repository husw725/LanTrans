# 🎬 LanTrans - 视频翻译与字幕嵌入工具

LanTrans 是一个基于 Streamlit 构建的桌面应用，旨在提供一套完整、高效的视频多语言翻译和字幕处理解决方案。它将复杂的视频处理流程整合到一个直观的图形用户界面中，帮助用户轻松完成从字幕翻译、样式设计到视频合成的全部工作。

## ✨ 主要功能

- **🤖 批量 AI 翻译**：利用 OpenAI API 批量翻译 SRT 字幕文件，支持多语言并发处理。
- **🧠 翻译记忆**：为每种目标语言维护一个独立的记忆文件，确保术语和风格在多集内容中保持一致性。
- **🔄 单集微调**：提供对单个字幕文件的重新翻译功能，方便进行质量修正和细节优化。
- **🎨 可视化样式编辑器**：所见即所得的字幕样式设计器，可实时预览字体、颜色、大小、描边、阴影和位置等效果。
- **🎞️ 批量字幕嵌入**：将设计好的字幕样式批量硬编码（Hardcode）到视频文件中。
- **🗜️ 视频压缩**：内置独立的视频压缩工具，可在处理完成后减小文件体积，方便分发。
- **🌓 现代 UI**：界面美观，布局清晰，并支持在浅色和深色主题之间一键切换。

## 🛠️ 技术栈

- **核心框架**: Python
- **用户界面**: Streamlit
- **AI 翻译**: OpenAI API
- **视频处理**: MoviePy
- **字幕解析**: pysrt

## 🚀 安装与启动

请按照以下步骤在您的本地环境中设置并运行 LanTrans。

### 1. 克隆仓库

```bash
git clone <your-repository-url>
cd LanTrans
```

### 2. 创建虚拟环境 (推荐)

为了保持项目依赖的隔离，建议使用虚拟环境。

```bash
# Windows
python -m venv .venv
.venv\Scripts\activate

# macOS / Linux
python3 -m venv .venv
source .venv/bin/activate
```

### 3. 安装依赖

从 `requirements.txt` 文件安装所有必需的 Python 包。

```bash
pip install -r requirements.txt
```

### 4. 配置环境变量

项目需要一个 `.env` 文件来管理 API 密钥和其他配置。

a. 在项目根目录下创建一个名为 `.env` 的文件。

b. 根据下面的模板填入您的信息：

```env
# 必填：你的 OpenAI API Key
OPENAI_API_KEY="sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"

# 可选 (Windows 用户需要): ImageMagick 的路径
# MoviePy 需要使用 ImageMagick 来渲染文本。请先安装它，然后将其可执行文件路径填入下方。
# 示例: IMAGEMAGICK_BINARY="C:\\Program Files\\ImageMagick-7.1.0-Q16-HDRI\\magick.exe"
IMAGEMAGICK_BINARY=""
```

**注意**: 如果您使用的是 Windows 系统，请务必安装 [ImageMagick](https://imagemagick.org/script/download.php) 并正确配置 `IMAGEMAGICK_BINARY` 路径，否则 Step 3 的字幕渲染会失败。

### 5. 启动应用

一切就绪！运行以下命令来启动 LanTrans 应用。

```bash
streamlit run main.py
```
应用将在您的默认浏览器中自动打开。

## 📖 工作流程指南

应用的使用流程被设计为四个直观的步骤：

### **Step 1: 📝 批量翻译 SRT**
1.  在 **SRT 输入文件夹路径**中，提供存放原始 `.srt` 文件的文件夹。
2.  在 **翻译结果输出文件夹路径**中，指定一个用于保存翻译后文件的位置。
3.  选择您需要翻译的**目标语言**（可多选）。
4.  点击 **“开始批量翻译”**。程序将为每种语言创建一个子文件夹，并开始处理任务。

### **Step 2: 🔄 单集重新翻译 (可选)**
1.  如果对某一个文件的翻译不满意，可以在此步骤进行修正。
2.  指向 Step 1 的输出文件夹，并选择需要重新翻译的 SRT 文件和语言。
3.  点击 **“开始重新翻译”**，生成一个带有 `retranslated_` 前缀的新文件。

### **Step 3: 🎨 批量添加字幕**
这个步骤分为两个选项卡：
1.  **字幕样式设计**：
    - 上传一个预览视频。
    - 在右侧的参数面板中调整字体、颜色、位置等，直到您对预览效果满意为止。样式会自动保存。
2.  **批量添加字幕**：
    - 切换到此选项卡。
    - 分别提供原始视频、翻译好的 SRT 字幕以及最终视频的输出文件夹路径。
    - 选择匹配方式和压缩质量。
    - 点击 **“开始批量添加字幕”**，程序会将您设计的样式应用到所有视频上。

### **Step 4: 🗜️ 批量压缩视频 (可选)**
1.  如果您希望进一步减小最终视频的文件大小，可以使用此工具。
2.  提供输入和输出文件夹路径。
3.  通过滑块选择一个合适的 **CRF 压缩质量** 值（值越低，质量越高）。
4.  点击 **“开始压缩视频”**。

---
*祝您使用愉快！*